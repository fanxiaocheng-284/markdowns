# 关于代码优化

重构/优化前问自己几个问题：

	1、明确哪里需要优化？
	2、优化成什么样子？带来的那些方面的提升？
	3、用什么方法去优化？
	4、当前是否有必要做此优化？是否有优先级更高的优化需要做？
	5、你的优化，后面的人能否看得懂，觉得有价值 ？
	
## 优化细节

优化细节上来说，优化要遵循以下原则

1. 易读性优于其它
2. 如果不是性能瓶颈，就不要为了性能而改写代码
3. 复杂性守恒原则：无论你怎么写代码，复杂性都是不会消失的

> 推论：如果逻辑很复杂，那么代码看起来就应该是复杂的。如果逻辑很简单，代码看起来就应该是简单的。

所以在某些情况，是可以在保持易读性的情况下损失适当的性能，比如

* 定义一些语义化变量暂存一些较为长段的公式的结果，而不是把大段的公式放入判断代码中然后补上一句注释。
* 尽量避免使用意义不明的逻辑处理方式，如果有，可以单独写出一个方法并通过变量的方式注明方法的用途，或者可以使用性能较差但是更易理解的方式实现功能。

其次，是代码性能上的优化，在不影响易读性的前提下，可以使用如下方法：（注：除非是性能瓶颈，不要单独为了性能改代码，Ummmm，永远不要小瞧浏览器，如果卡，一定是某部分逻辑一直处于重复执行状态且无法跳出，这个应该算bug吧😂）

* 尽可能使用空间来替换查询所需要的时间
* 利用算法优化去除不必要的空间占用
* 去除原有代码部分高频率重复执行的逻辑

接下去，就是满足业务需求的低质量代码了，这部分代码可能对于单个页面来说影响甚微，但是如果在长迭代的项目中多次出现相似代码的情况下，是很有可能提高后续代码开发成本的。

具体来说低质量代码有以下几种类型：

1. 表里不一的代码，即方法变量名称与其实际功能不匹配，很有可能带来代码上的误解。
2. 过时的注释
3. 逻辑很简单，但是看起来很复杂的代码 很多时候会有一些目的简单但是实现绕了远路的代码，造成理解的成本和执行效率的降低
4. 大块重复的代码有必要提取
5. 相似的代码需要抽象
6. 总是一起出现的代码可以对这些逻辑再做一次封装，并注明这段逻辑的功能
7. 代码出入口不统一，结构/流程混乱

大多数低质量代码可以使用封装的方式去处理相应问题，优质的代码能够做到调用/移植成本低，执行过程可扩展，流程可控，结果可控，方法细节可替换的效果。

封装的话有函数式编程与面向对象编程两种可行性较高的方式去处理。

## 函数式编程

> 将既有代码以动作概念把既有代码拆分为一个个函数，利用一连串动作函数的执行把流程代码提炼为动作的集合

优势：

* 由于本身不存在状态管理，所以没有并发的问题
* 不存在多余的空间保存其余数据，占用空间更小，执行的内容比面向对象方式更加高效
* 更注重方法的输入输出，所以能很好的保证方法在执行过程上的统一和预计结果的相对一致

劣势：

* 无法进行状态管理，所以在一些状态判断的逻辑上有很大短板
* 方法在执行过程中都是使用临时变量，所以在某一方法执行完成并执行下一方法的时候无法拿到上一个方法中获取的某一变量

## 面向对象编程

> 将代码看作一种在程序中包含各种独立而又互相调用的对象，对象本身可以保存各种数据与行为

优势：

* 保证了代码的灵活性和可维护性
* 能够更简单地设计并维护程序，使得程序更加便于分析、设计、理解
* 易拓展，由于继承、封装、多态的特性，自然设计出高内聚、低耦合的系统结构，使得系统更灵活、更容易扩展，而且成本较低

劣势：

* 由于其本身为数据与方法的集合，不可避免的需要更多的内存去保存相应的内容
* 在多线程并发编程中，多个线程同时操作数据的时候可能会导致数据修改的不确定性
* 因为面向对象编程不可避免的考虑了过多的可重用性原则，所以针对当前项目而言，实际代码量是高于需求代码量的，增加了或多或少的时间成本


以上。